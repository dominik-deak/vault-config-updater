#!/bin/sh

echo "ğŸš€ Running pre-push checks..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# 1. Lint check (strict mode - warnings as errors, all targets including tests)
echo "ğŸ” Running cargo clippy on all targets (treating warnings as errors)..."
cargo clippy --all-targets -- -D warnings
if [ $? -ne 0 ]; then
    echo "âŒ Clippy check failed! Fix linting issues before pushing."
    exit 1
fi
echo "âœ… Clippy check passed"
echo ""

# 2. Compile check
echo "ğŸ”¨ Running cargo check..."
cargo check
if [ $? -ne 0 ]; then
    echo "âŒ Compilation check failed! Fix compile errors before pushing."
    exit 1
fi
echo "âœ… Compilation check passed"
echo ""

# 3. Run all tests
echo "ğŸ§ª Running all tests..."
cargo test
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed! Fix failing tests before pushing."
    exit 1
fi
echo "âœ… All tests passed"
echo ""

# 4. Security audit
echo "ğŸ”’ Running security audit..."
cargo audit
if [ $? -ne 0 ]; then
    echo "âŒ Security audit found vulnerabilities! Review and fix before pushing."
    exit 1
fi
echo "âœ… Security audit passed"
echo ""

echo "ğŸ‰ All pre-push checks passed! Safe to push."
exit 0